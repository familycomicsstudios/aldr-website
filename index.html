<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Appel Level Difficulty Rankings</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" type="image/png" href="/logo.png">
</head>
<body class="bg-gray-900 text-gray-200 p-4">
  <div id="dynamicHeader" class="w-full h-60 mb-4 bg-cover bg-center rounded-lg shadow-lg">
      <!-- fallback text if no header yet -->
      <div class="w-full h-full bg-gray-800 bg-opacity-70 flex items-center justify-center text-2xl font-bold">
          Appel Level Difficulty Rankings
      </div>
  </div>

  <p class="text-white">
    The Appel Level Difficulty Rankings is a list that ranks Appel levels based on their difficulty,
    with a combination of skills required to beat the level and jumps that you need to learn to beat the level.
    The list is sorted by a combination of Skill and Learn points, which can be adjusted using the Difficulty Bias slider.
    Impossible and Challenge levels are hidden by default, but can be shown using the checkboxes below.
    Click on a level to see more details, including the project, notes, video, victors, and level code.
    Click on a player in the victors list to see all levels they have beaten.<br>

    Join the ALDR Discord server for discussions, suggestions, and more: <a href="https://discord.gg/GZvSKKnHPu" class="text-blue-400 hover:underline">https://discord.gg/GZvSKKnHPu</a>
    <small>If you came here from the Scratch forums, use Discord at your own risk!</small>
  </p><br>
  <p class="flex gap-4 items-center">Difficulty Scale: <select id="systemSelect" class="p-2 rounded bg-gray-700 text-gray-200">
    <option value="punter">Punter</option>
    <option value="scheep">Scheep</option>
    <option value="michaelchan">MichaelChan</option>
    <option value="grassy">Grassy</option>
  </select>
  <label class="flex items-center gap-2 text-gray-300">
    <input type="checkbox" id="visualMode" class="form-checkbox" checked>
    Show Thumbnails
  </label></p><br>

  <div class="mb-4">
    <button id="rulesButton" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded">
      Show Rules
    </button>
    <button id="leaderboardButton" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded">
      Show Leaderboard
    </button>
    <button class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded"><a href="https://docs.google.com/forms/d/e/1FAIpQLSdipbJrTE5qBR7ZhDc6v3JfVkRGVr01gtKdd83PskX0JMR_tQ/viewform?usp=header">
      Submit a Level
    </a></button>
    <button id="openCompletionModal" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded">
      Submit a Completion
    </button>
  </div>

  <div class="mb-4 flex gap-4 items-center">
  <input id="searchInput" type="text" placeholder="Search levels..." 
         class="w-1/3 p-2 rounded bg-gray-700 text-gray-200" />

  <select id="sortSelect" class="p-2 rounded bg-gray-700 text-gray-200">
    <option value="points">Sort by List Points</option>
    <option value="name">Sort by Level Name</option>
    <option value="creator">Sort by Creator</option>
    <option value="id">Sort by ALDR ID</option>
  </select>
</div>

  

  <div class="mb-4">
    <label class="block mb-2 font-semibold text-gray-300">Difficulty Bias Slider (Skill ↔ Learny) <span id="biasLabel" class="ml-2 text-sm font-normal"></span></label>
    <input id="biasSlider" type="range" min="0" max="100" step="5" value="50" class="w-full">
  </div>
  <div class="mb-4 flex gap-4">
    <label class="flex items-center gap-2 text-gray-300">
      <input type="checkbox" id="showImpossible" class="form-checkbox">
      Show Impossible Levels
    </label>
    <label class="flex items-center gap-2 text-gray-300">
      <input type="checkbox" id="showChallenge" class="form-checkbox">
      Show Challenge Levels
    </label>
  </div>

  <table class="min-w-full bg-gray-800 border border-gray-700" id="levelsTable">
    <thead>
      <tr class="bg-gray-700">
        <th class="py-2 px-4 border-b border-gray-600">#</th>
        <th class="py-2 px-4 border-b border-gray-600">ALDR ID</th>
        <th class="py-2 px-4 border-b border-gray-600">Level Name</th>
        <th class="py-2 px-4 border-b border-gray-600">Creator</th>
        <th class="py-2 px-4 border-b border-gray-600">Difficulty</th>
        <th class="py-2 px-4 border-b border-gray-600">List Points</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

  <!-- Level Modal -->
  <div id="modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden">
    <div class="bg-gray-800 p-6 rounded-lg w-1/2 max-h-[80vh] overflow-y-auto relative">
      <button id="modalClose" class="absolute top-2 right-2 text-gray-300 hover:text-white">✖</button>
      <h2 id="modalName" class="text-xl font-bold mb-2"></h2>
      
      <p id="modalSkillBalanceContainer"><strong>Skills Balance:</strong> <span id="modalSkillBalance"></span></p>
      <p id="modalProjectContainer"><strong>Project:</strong> <a id="modalProject" class="text-blue-400 hover:underline" href="#" target="_blank"></a></p>

      <div id="modalVideoContainer" class="w-full aspect-video mb-2">
        <p><strong>Video:</strong></p>
        <iframe id="modalVideoEmbed" class="w-full h-full rounded" src="" frameborder="0" allowfullscreen></iframe>
      </div>


      <p id="modalNotesContainer"><strong>Notes:</strong> <span id="modalNotes"></span></p>

      <p id="modalCodeContainer"><strong>Level Code:</strong></p>
      <input id="modalCode" type="text" readonly class="w-full bg-gray-700 text-gray-200 p-1 rounded mt-1">

      <p id="modalVictorsContainer"><strong>Victors:</strong></p>
      <ul id="modalVictors" class="list-disc ml-5"></ul>
    </div>
  </div>


  <!-- Player Modal -->
  <div id="playerModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden">
    <div class="bg-gray-800 p-6 rounded-lg w-1/2 max-h-[80vh] overflow-y-auto relative">
      <button id="playerModalClose" class="absolute top-2 right-2 text-gray-300 hover:text-white">✖</button>
      <h2 id="playerName" class="text-xl font-bold mb-2"></h2>
      <p><strong>Total List Points:</strong> <span id="playerPoints"></span></p>
      <p><strong>Total Levels Beaten:</strong> <span id="playerLevels"></span></p>
      <button id="makeProfileCardBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded mb-4">Make Profile Card</button>
      <div id="profileCardContainer" class="mb-4 hidden">
        <canvas id="profileCardCanvas" class="rounded"></canvas>
        <button id="downloadProfileCardBtn" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded mt-2">Download Profile Card</button>
      </div>
      <div class="flex items-center gap-2 mb-2">
        <p><strong id="playerLevelListLabel">Levels (Cleared):</strong></p>
        <select id="playerLevelFilter" class="p-1 rounded bg-gray-700 text-gray-200">
          <option value="cleared">Cleared</option>
          <option value="uncleared">Uncleared</option>
        </select>
      </div>
      <ul id="playerLevelList" class="list-disc ml-5"></ul>
    </div>
  </div>

  <!-- Rules Modal -->
  <div id="rulesModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden">
    <div class="bg-gray-800 p-6 rounded-lg w-1/2 max-h-[80vh] overflow-y-auto relative">
      <button id="rulesModalClose" class="absolute top-2 right-2 text-gray-300 hover:text-white">✖</button>
      <h2 class="text-xl font-bold mb-4">Appel Level Rankings Rules</h2>
      <h3 class="text-xl font-bold mb-4">Level Rules</h3>
      <ul class="list-disc ml-5 space-y-2 text-gray-200">
        <li>Levels must be made in Appel to be eligible for ranking.</li>
        <li>Levels must be beatable by at least one person, or they will be marked as Impossible.</li>
        <li>Levels with low-effort gameplay will be marked as Challenge levels.</li>
        <li>Levels must have either good gameplay or good decoration. A level with bad gameplay must have good decoration
          to be ranked, and vice versa. Levels will not be added if they have no effort put into them.
        </li>
        <small><li>Levels that are extremely unique or notable may also be placed even if they do not meet quality standards,
          but this is rare and at the discretion of the list maintainers.
        </li></small>
        <li>Levels must be submitted with a replay code from the Appel game, or whatever Appel mod the game was made with.</li>
        <li>Levels that do not work in the latest version of Appel must have the mod they are made in specified.</li>
      </ul>
      <br>
      <h3 class="text-xl font-bold mb-4">List Points Rules</h3>
      <ul class="list-disc ml-5 space-y-2 text-gray-200">
        <li>Levels must be beaten in either vanilla Appel, the mod the level was created in, or a moderator-approved QOL mod.</li>
        <li>Levels must be beaten without macros or TAS, at 30FPS.</li>
        <li>Levels must be beaten with no cheats or hacks - the replay must be unaltered and show the entire level being completed.</li>
        <li>Levels may be beaten as a segmented run starting from a checkpoint, but this is not allowed if the level has any softlocks.</li>
        <li>If the level's notes specify that the level must be played in the project, the run must be done in that project - not Vanilla Appel
          nor an approved QOL mod for Vanilla Appel. QOL mods for that specific project are still allowed, however.</li>
      </ul>
    </div>
  </div>

  <!-- Leaderboard Modal -->
  <div id="leaderboardModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden">
    <div class="bg-gray-800 p-6 rounded-lg w-1/2 max-h-[80vh] overflow-y-auto relative">
      <button id="leaderboardModalClose" class="absolute top-2 right-2 text-gray-300 hover:text-white">✖</button>
      <h2 class="text-xl font-bold mb-4">Leaderboard</h2>
      <select id="leaderboardSelector" class="p-2 rounded bg-gray-700 text-gray-200 mb-2">
        <option value="casual">Casual</option>
        <option value="competitive">Competitive</option>
        <option value="levelsBeaten">Levels Beaten</option>
      </select>

      <ol id="leaderboardList" class="list-decimal ml-5 space-y-2 text-gray-200"></ol>
    </div>
  </div>

  <div id="completionModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden">
    <div class="bg-gray-800 p-6 rounded-lg w-1/2 max-h-[80vh] overflow-y-auto relative">
      <button id="completionModalClose" class="absolute top-2 right-2 text-gray-300 hover:text-white">✖</button>
      <h2 class="text-xl font-bold mb-4">Submit a Completion</h2>
      
      <form id="completionForm" class="space-y-4">
        <div>
          <label class="block font-semibold">Username</label>
          <input id="username" type="text" maxlength="50" required 
                 class="w-full p-2 rounded bg-gray-700 text-gray-200" placeholder="Your username">
        </div>

        <div>
          <label class="block font-semibold">ALDR ID</label>
          <input id="aldrId" type="number" max="9999" required 
                 class="w-full p-2 rounded bg-gray-700 text-gray-200" placeholder="Level ID (e.g., 123)">
        </div>

        <div>
          <label class="block font-semibold">Proof of Completion</label>
          <textarea id="proof" rows="4" maxlength="4000" required
                    class="w-full p-2 rounded bg-gray-700 text-gray-200"
                    placeholder="Link or detailed description of proof"></textarea>
        </div>

        <div>
          <label class="block font-semibold">Notes (optional)</label>
          <textarea id="notes" rows="3" maxlength="1000"
                    class="w-full p-2 rounded bg-gray-700 text-gray-200"
                    placeholder="Any extra information or comments"></textarea>
        </div>

        <button type="submit" 
                class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded">
          Submit Completion
        </button>
      </form>

      <p id="completionStatus" class="mt-4 text-sm text-gray-400"></p>
    </div>
  </div>



  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <script type="module" src="main.js"></script>
</body>
</html>
